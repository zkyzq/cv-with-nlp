## 滤镜介绍
&emsp;图像滤镜实际上就是改变自然图像的像素或者像素之间的关系（诶，这句话让我想起了初中的时候学化学，说起化学是研究物质及其变化的一门学科）
OpenCV中的Photo模块实现了数码相片相关的处理算法，还在不断的完善中，那么，既然已经有一些造好的轮子，咱们就来使用一下吧～

## 深入浅出各个滤镜函数

#### edgePreservingFilter  
- 深入   

从名字也可以看出，这是一个实现了保留图像边缘信息的滤波器，函数的定义如下：
```
/** @brief Filtering is the fundamental operation in image and video processing. Edge-preserving smoothing
filters are used in many different applications @cite EM11 .

@param src Input 8-bit 3-channel image.
@param dst Output 8-bit 3-channel image.
@param flags Edge preserving filters: cv::RECURS_FILTER or cv::NORMCONV_FILTER
@param sigma_s %Range between 0 to 200.
@param sigma_r %Range between 0 to 1.
 */
CV_EXPORTS_W void edgePreservingFilter(InputArray src, OutputArray dst, int flags = 1,
        float sigma_s = 60, float sigma_r = 0.4f);
```
输入和输出都是3通道的CV8U类型的图像，并且有两个滤镜选择，一个是递归滤镜Recursive Filtering，一个是归一化卷积滤镜Normalized Convolution Filtering。另外两个参数选择如下：
sigma_s：取值范围为 0～200。

sigma_r：取值范围为 0～1。

当sigma_s 取值不变时候，sigma_r 越大图像滤波效果越明显；

当sigma_r 取值不变时候，窗口 sigma_s 越大图像模糊效果越明显；

当sgma_r取值很小的时候，窗口 sigma_s 取值无论如何变化，图像双边滤波效果都不是很好。

我们来看下这个函数的源码，发现比我们想象的要简单很多：
```
void cv::edgePreservingFilter(InputArray _src, OutputArray dst, int flags, float sigma_s, float sigma_r)
{
    CV_INSTRUMENT_REGION();

    Mat I = _src.getMat();

    Domain_Filter obj;

    Mat img;
    I.convertTo(img,CV_32FC3,1.0/255.0);

    Mat res;
    obj.filter(img, res, sigma_s, sigma_r, flags);

    convertScaleAbs(res, dst, 255,0);
}
```
这个就得益于OpenCV之前封装了关于filter的部分，这个功能非常强大。滤波均可以转换为底层的卷积操作，也就是向量之间做内积。这就是面向对象程序设计的优越之处。
- **浅出**
如何使用？特别简单：
```
Mat img = imread("test.jpg");
Mat img_out = img.clone();
edgePreservingFilter(img,img_out,1);

```
此滤镜可以达到磨皮的效果。示意如下:
()[https://github.com/zhangqizky/cv-with-nlp/blob/master/img/cow.jpg]
()[https://github.com/zhangqizky/cv-with-nlp/blob/master/img/edgePreservingFilter-1.jpg]

#### detailEnhance  
此滤镜是一个增强细节的滤镜，输入输出和上面是一样的，后面两个参数分别表示窗口和滤波的程度。实现的是论文 Domain transform for edge-aware image and video processing的算法效果。
```
/** @brief This filter enhances the details of a particular image.

@param src Input 8-bit 3-channel image.
@param dst Output image with the same size and type as src.
@param sigma_s %Range between 0 to 200.
@param sigma_r %Range between 0 to 1.
 */
CV_EXPORTS_W void detailEnhance(InputArray src, OutputArray dst, float sigma_s = 10,
        float sigma_r = 0.15f);
```
示意如下：
[](https://github.com/zhangqizky/cv-with-nlp/blob/master/img/cow.jpg)
[](https://github.com/zhangqizky/cv-with-nlp/blob/master/img/detailEnhance.jpg)
#### pencilSketch
这个与上面两个函数的输入和输出都相同，最后所呈现的效果是铅笔素描形式的。
```
/** @example samples/cpp/tutorial_code/photo/non_photorealistic_rendering/npr_demo.cpp
An example using non-photorealistic line drawing functions
*/
/** @brief Pencil-like non-photorealistic line drawing

@param src Input 8-bit 3-channel image.
@param dst1 Output 8-bit 1-channel image.
@param dst2 Output image with the same size and type as src.
@param sigma_s %Range between 0 to 200.
@param sigma_r %Range between 0 to 1.
@param shade_factor %Range between 0 to 0.1.
 */
CV_EXPORTS_W void pencilSketch(InputArray src, OutputArray dst1, OutputArray dst2,
        float sigma_s = 60, float sigma_r = 0.07f, float shade_factor = 0.02f);
```
结果示意：
[!img3](https://github.com/zhangqizky/cv-with-nlp/blob/master/img/cow.jpg)
[!dst3](https://github.com/zhangqizky/cv-with-nlp/blob/master/img/pencilSketch.jpg)
#### stylization
此滤镜是一个动漫风格滤镜。

```
/** @brief Stylization aims to produce digital imagery with a wide variety of effects not focused on
photorealism. Edge-aware filters are ideal for stylization, as they can abstract regions of low
contrast while preserving, or enhancing, high-contrast features.

@param src Input 8-bit 3-channel image.
@param dst Output image with the same size and type as src.
@param sigma_s %Range between 0 to 200.
@param sigma_r %Range between 0 to 1.
 */
CV_EXPORTS_W void stylization(InputArray src, OutputArray dst, float sigma_s = 60,
        float sigma_r = 0.45f);
```
结果示意:
[](https://github.com/zhangqizky/cv-with-nlp/blob/master/img/cow.jpg)
[](https://github.com/zhangqizky/cv-with-nlp/blob/master/img/stylization.jpg)
